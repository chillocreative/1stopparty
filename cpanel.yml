deployment:
  tasks:
    # 1. Pastikan composer dependencies dipasang
    - export DEPLOYPATH=/home/keadilan/sys.keadilankb.com
    - /opt/cpanel/composer/bin/composer install --no-dev --optimize-autoloader

    # 2. Copy semua file ke document root (kecuali yang tak perlu)
    - /bin/rsync -av --exclude='.git' --exclude='node_modules' --exclude='tests' ./ $DEPLOYPATH

    # 3. Jalankan artisan commands untuk clear & cache
    - /usr/bin/php -d register_argc_argv=On $DEPLOYPATH/artisan config:clear
    - /usr/bin/php -d register_argc_argv=On $DEPLOYPATH/artisan config:cache
    - /usr/bin/php -d register_argc_argv=On $DEPLOYPATH/artisan route:cache
    - /usr/bin/php -d register_argc_argv=On $DEPLOYPATH/artisan view:clear

    # 4. Kalau ada migration, uncomment baris ini
    # - /usr/bin/php -d register_argc_argv=On $DEPLOYPATH/artisan migrate --force

    # 5. Build asset untuk Laravel Breeze (Vite)
    - /bin/npm install --prefix $DEPLOYPATH
    - /bin/npm run build --prefix $DEPLOYPATH
